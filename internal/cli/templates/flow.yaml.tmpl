name: {{.FlowName}}
source:
{{- if eq .Source "http"}}
  type: http
  config:
    listenAddr: ":8081"
    path: /ingest
{{- else if eq .Source "kafka"}}
  type: kafka
  config:
    brokers:
      - kafka:9092
    topic: my-events
    consumerGroup: fiso-{{.FlowName}}
    startOffset: latest
{{- end}}
{{- if eq .Transform "fields"}}
transform:
  fields:
    id: data.id
    processed_at: time
{{- end}}
{{- if .CloudEvents}}
cloudevents:
  id: "data.eventId"     # CEL expression for idempotency (optional)
  type: app.event.created
  source: my-service
  subject: "data.id"
  # data: "data.payload"              # Optional: use specific field as data (default: transformed payload)
  # datacontenttype: "application/json"  # Optional: content type (default: application/json)
  # dataschema: "https://example.com/schemas/v1/event.json"  # Optional: schema URL
{{- end}}
sink:
{{- if eq .Sink "http"}}
  type: http
  config:
    url: http://user-service:8082
    method: POST
{{- else if eq .Sink "temporal"}}
  type: temporal
  config:
    hostPort: temporal:7233
    namespace: default
    taskQueue: my-task-queue
    workflowType: ProcessEvent
    # workflowIdExpr: "{{.eventId}}-{{.ctn}}"  # Optional: template for workflow ID
    # mode: start                               # Optional: start (default) or signal
    # params:                                   # Optional: typed workflow parameters (cross-SDK compatible)
    #   - expr: "data.eventId"                  # CEL expression evaluated against event
    #   - expr: "data.ctn"
    #   - expr: "data.accountId"
    #   - expr: "data.amount"
{{- end}}
{{- if eq .Source "kafka"}}
errorHandling:
  deadLetterTopic: fiso-dlq-{{.FlowName}}
  maxRetries: 3
{{- end}}
